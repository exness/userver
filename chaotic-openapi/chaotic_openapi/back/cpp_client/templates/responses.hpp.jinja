#pragma once

#include <variant>

#include <client/{{ name }}/exceptions.hpp>
{% for include in spec.responses_declaration_includes() %}
  #include <{{ include }}>
{% endfor %}

{% for include in spec.cpp_includes() %}
#include <{{ include }}>
{% endfor %}

USERVER_NAMESPACE_BEGIN
namespace clients::http {
class Response;
}
USERVER_NAMESPACE_END

namespace {{ namespace }} {

{% for op in operations %}
  {% if op.client_generate %}
      namespace {{ op.cpp_namespace() }} {
      class BaseResponseError : public std::runtime_error {
        public:
          BaseResponseError() : std::runtime_error("") {}
      };
        {% for response in op.responses %}
          {# TODO: description #}
          struct Response{{ response.status }} 
          {%- if response.is_error() -%}
              : public BaseResponseError
          {%- endif -%}
          {
            {% if len(response.body) == 0 %}
              {# No body #}
            {% elif len(response.body) == 1 %}
                // {{ response.body }}
              {{ list(response.body.values())[0].cpp_user_name() }} body;
            {% else %}
              {{ NOT_IMPLEMENTED("2+ response content types") }}
            {% endif %}

            {% for header in response.headers %}
              {{ NOT_IMPLEMENTED("response header") }}
            {% endfor %}
          };
        {% endfor %}

        {% if op.has_single_2xx_responses() %}
          using Response = 
            {%- for response in op.iter_2xx_responses() -%}
              Response{{ response.status }}
            {%- endfor -%}
          ;
        {% elif op.has_2xx_responses() %}
          using Response = std::variant<
            {% for response in op.iter_2xx_responses() -%}
              Response{{ response.status }} {% if not loop.last %},{% endif -%}
            {%- endfor -%}
          >;
        {% else %}
          using Response = void;
        {% endif %}

        Response ParseResponse(USERVER_NAMESPACE::clients::http::Response& response);
      }
  {% endif %}
{% endfor %}

}
